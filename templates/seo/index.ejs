<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <title>Document</title>
    <style>
        input[type="file"] {
            display: none;
        }
        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="myNavbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="">Клиенты</a></li>
                    <li><a href="">Запросы</a></li>
                    <li><a href="">Оплаты</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/user-registration" style="background-color: #6466AB; color: #fff">Регистрация нового клиента</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!--<div class="container">
        <div class="row">
            <% for (var i = 0; i < user.length; i++) { %>
            <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" style="border: 3px solid #00f; margin: 10px;">
                <h3><a href="/seo/<%= user[i].id %>"><%= user[i].name %></a></h3>
                <h4><%= user[i].company %></h4>
                <h4><%= user[i].phone %></h4>
                <button class="btn btn-warning">Отчёт</button>
            </div>
            <% } %>
        </div>
    </div>-->

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Клиент</th>
                            <th>Отчёт</th>
                            <th>3</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for (var i = 0; i < user.length; i++) { %>
                        <tr>
                            <td><a href="/seo/<%= user[i].id %>"><%= user[i].name %></a></td>

                            <% if(!report[i]) { %>
                                <td>
                                    <label for="file-upload" class="custom-file-upload">
                                        <i class="fa fa-cloud-upload fa-2x" style="color: #E9573F"> Загрузить</i>
                                    </label>
                                    <input id="file-upload" class="upload" name="uploadFile" type="file" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" placeholder=<%= user[i].id%> />
                                
                                </td>
                            <% } else  { %>
                                <td><i class="fa fa-check-circle fa-2x" style="color: #8CC152"></i></td>
                            <% } %>
                            
                            <td>3</td>
                        </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="../jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="../bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>

    <script>
        $('body').on('change', '.upload', function() { 
            var id = this.placeholder;

            var file = $(this).get(0).files[0];
            
            var formData = new FormData();
            formData.append('uploadFile', file, "uploadFile");

            console.log(formData);
            console.log(file);

            $.ajax({
                url: '/seo',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log('upload successful!\n' + data);
                }
                // xhr: function () {
                //     // create an XMLHttpRequest
                //     var xhr = new XMLHttpRequest();

                //     // listen to the 'progress' event
                //     // xhr.upload.addEventListener('progress', function (evt) {

                //     //     if (evt.lengthComputable) {
                //     //         // calculate the percentage of upload completed
                //     //         var percentComplete = evt.loaded / evt.total;
                //     //         percentComplete = parseInt(percentComplete * 100);

                //     //         // update the Bootstrap progress bar with the new percentage
                //     //         $('.progress-bar').text(percentComplete + '%');
                //     //         $('.progress-bar').width(percentComplete + '%');

                //     //         // once the upload reaches 100%, set the progress bar text to done
                //     //         if (percentComplete === 100) {
                //     //             $('.progress-bar').html('Done');
                //     //         }

                //     //     }

                //     // }, false);

                //     return xhr;
                // }
            });
        })
    </script>
</body>

</html>